
\subsection{MAC-Layer Protocols}
The routing handler is dependant on both getting incoming packets delivered as well as being able to transmit outgoing packets through a corresponding MAC-layer protocol. Handling incoming packets presents the most interesting challenge in this part. We identify two ways of handling incoming packets:
\begin{enumerate}
	\item Run a periodic event handler that periodically polls registers for the hardware device. When new data is received, the handler should extract the packet and deliver it to the routing handler.
	\item Run an aperiodic event handler that fires on a hardware generated interrupt from the device when data is available. The handler logic should then extract the packet and deliver it to the routing handler.
\end{enumerate}
 
The first option has the advantage of being more easily analysable as a result of being periodic. The second approach, has the advantage of not occupying computation time unless data is available. As only loopback and \iic will be supported currently this would result in two handlers in either case (assuming both protocols were used in the same application). However, in case of further MAC-layer protocols (e.g. KISS or RS232) this would result in several handlers. In the case of using periodic handlers, we estimate this would result in many unnecessary releases and executions. We adopt the second approach such that the logic for reading a frame in a protocol is implemented as an aperiodic event handler. We are aware that this presents an increased challenge for the analysis of applications. In the case of a response-time analysis this will require techniques for removing the requirement in the simple task model of only periodic tasks. Note that in the C implementation and supporting material GomSpace uses and advises the use of DMA and interrupt based drivers. However, DMA is not available on JOP currently. Therefore, in the \iic MAC-layer protocol, manually reading and transmitting frames in the registers through hardware objects is necessary.
